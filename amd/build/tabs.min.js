define("format_topics2/tabs",["jquery","core/str"],(function($){return{init:function(){function add2tab(tabnum,sectionid,sectionnum){$(".tablink").each((function(){$(this).attr("sections",$(this).attr("sections").replace(","+sectionid,"")),$(this).attr("sections",$(this).attr("sections").replace(sectionid+",","")),$(this).attr("sections",$(this).attr("sections").replace(sectionid,"")),$(this).attr("section_nums",$(this).attr("section_nums").replace(","+sectionnum,"")),$(this).attr("section_nums",$(this).attr("section_nums").replace(sectionnum+",","")),$(this).attr("section_nums",$(this).attr("section_nums").replace(sectionnum,""))})),tabnum>0&&(0===$("#tab"+tabnum).attr("sections").length?$("#tab"+tabnum).attr("sections",$("#tab"+tabnum).attr("sections")+sectionid):$("#tab"+tabnum).attr("sections",$("#tab"+tabnum).attr("sections")+","+sectionid),0===$("#tab"+tabnum).attr("section_nums").length?$("#tab"+tabnum).attr("section_nums",$("#tab"+tabnum).attr("section_nums")+sectionnum):$("#tab"+tabnum).attr("section_nums",$("#tab"+tabnum).attr("section_nums")+","+sectionnum))}var escapeHtml=function(text){var map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return text.replace(/[&<>"']/g,(function(m){return map[m]}))},truncateAllTabnames=function(){$(".limittabname").length>0&&$(".tablink").each((function(){!function(tab){if($(".limittabname").length>0){var x=$(".limittabname").attr("value"),origTabTitle=tab.attr("tab_title");if(origTabTitle.length>x){var shortTabTitle=origTabTitle.substr(0,x)+String.fromCharCode(8230);tab.hasClass("tabsectionname")?tab.html(shortTabTitle):0===$(".inplaceeditingon").length&&($(".inplaceeditable").length>0?tab.find("a").html(tab.find("a").html().replace(escapeHtml(origTabTitle),shortTabTitle)):tab.html(tab.html().replace(escapeHtml(origTabTitle),shortTabTitle)))}}}($(this))}))},restoreTab=function(tab){var theBackup=tab.parent().find(".tabname_backup");tab.parent().find(".tabsectionname").removeClass("tabsectionname").html(theBackup.html()),theBackup.remove(),$(".sectionname").removeClass("edit_only").show(),$(".hidden.sectionname").show(),$(".section-handle").show(),$(".toggler_edit_only").removeClass("toggler_edit_only").show()},tabClick=function(){$(".tablink").on("click",(function(){var clickedTabName,courseid=$("#courseid").attr("courseid"),tabid=$(this).attr("id"),sectionArray=$(this).attr("sections").split(",");$(".tablink.active").removeClass("active"),$(this).addClass("active"),sessionStorage.setItem("courseid",courseid),sessionStorage.setItem("tabid",tabid),truncateAllTabnames(),function(tab){if($(".limittabname").length>0){var x=$(".limittabname").attr("value"),origTabTitle=tab.attr("tab_title");if(origTabTitle.length>x){var shortTabTitle=origTabTitle.substr(0,x)+String.fromCharCode(8230);if(tab.hasClass("tabsectionname"))tab.html(origTabTitle);else if(0===$(".inplaceeditingon").length)if($(".inplaceeditable").length>0){var dataValue=tab.find(".inplaceeditable").attr("data-value");origTabTitle!==dataValue&&(tab.attr("tab_title",dataValue),shortTabTitle=(origTabTitle=dataValue).substr(0,x)+String.fromCharCode(8230)),tab.find("a").html(tab.find("a").html().replace(escapeHtml(shortTabTitle),origTabTitle))}else tab.html(tab.html().replace(escapeHtml(shortTabTitle),origTabTitle))}}}($(this)),$(this).find(".inplaceeditable-text")&&(clickedTabName=$(this).find(".inplaceeditable-text").attr("data-value")),void 0===clickedTabName&&(clickedTabName=$(this).html()),"tab0"===tabid?($("#changenumsections").show(),$("li.section").removeClass("hidden").show(),$(".topictab:visible").each((function(){$(this).attr("sections").length>0&&$.each($(this).attr("sections").split(","),(function(index,value){$(".section[section-id='"+value+"']").addClass("hidden").hide()}))}))):($("#changenumsections").show(),$("li.section").addClass("hidden").hide(),$.each(sectionArray,(function(index,value){$(".section[section-id='"+value+"']").removeClass("hidden").show()}))),$("#ontop_area #section-0").removeClass("hidden").show();var element,tabtabindex,visibleSections=$("li.section:visible").length,hiddenSections=$("li.section:visible").find(".section_availability").find(".ishidden").length;if($(".section0_ontop").length>0&&visibleSections--,visibleSections<1){$(this).parent().hide();var genericTitle=$(this).attr("generic_title");$.ajax({url:"format/topics2/ajax/update_tab_name.php",type:"POST",data:{courseid:courseid,tabid:tabid,tab_name:genericTitle,sesskey:M.cfg.sesskey},success:function(result){""!==result&&($("[data-itemid="+result+"]").attr("data-value",genericTitle).find(".quickeditlink").html(genericTitle),initFunctions())}})}else $(this).parent().show();if($(".single_section_tabs").length>0&&1==$(this).attr("sections").split(",").length&&"tab0"!==tabid){var target=$("li.section:visible").first();$(".section0_ontop").length>0&&(target=$("li.section:visible:eq(1)"));var firstSectionId=target.attr("id");1==$(this).attr("sections").split(",").length&&"section-0"!==firstSectionId&&$(this).attr("generic_title").indexOf("Tab")>=0?(!function(tab,target){var origSectionname=target.find(".sectionname:not(.hidden)");if($(".tabname_backup:visible").length>-1){var theSectionname=target.attr("aria-label");tab.parent().append(tab.clone().addClass("tabname_backup").hide()),tab.html(theSectionname).addClass("tabsectionname"),tab.attr("tab_title",theSectionname),0===$(".inplaceeditable").length?(origSectionname.hide(),target.find(".sectionhead").hide()):(target.find(".toggler").addClass("toggler_edit_only").hide(),origSectionname.addClass("edit_only"))}}($(this),target),target.find(".toggle_area").removeClass("hidden").show()):$(".inplaceeditable").length>0&&"section-0"!==firstSectionId&&restoreTab($(this))}visibleSections<=hiddenSections?showTabHint($(this)):hideTabHint($(this)),"tab0"===tabid&&1===$(".tabitem:visible").length&&$(".tabitem").hide(),element=$(this),(tabtabindex=element.attr("tabindex"))>0&&$(".section.main:visible").each((function(){$(this).attr("tabindex",tabtabindex)}))}))},showTabHint=function(tab){var tabid=tab.attr("id");tab.addClass("hidden-tab"),require(["core/str"],(function(str){var getTheString=str.get_string("hidden_tab_hint","format_topics2");$.when(getTheString).done((function(theString){tab.find("#not-shown-hint-"+tabid).remove();var theAppendix='<i id="not-shown-hint-'+tabid+'" class="fa fa-info" title="'+theString+'"></i>';1==tab.attr("sections").split(",").length&&$(".single_section_tabs").length>0?tab.html(tab.html()+" "+theAppendix):$(".tablink .fa-pencil").length>0?tab.find(".inplaceeditable").append(theAppendix):tab.html(tab.html()+" "+theAppendix)}))}))},hideTabHint=function(tab){var tabid=tab.attr("id");tab.removeClass("hidden-tab"),$("#not-shown-hint-"+tabid).remove()},initFunctions=function(){tabClick(),$(".tab_mover").on("click",(function(){var tabnum=$(this).attr("tabnr"),sectionid=$(this).closest("li.section").attr("section-id"),sectionnum=$(this).closest("li.section").attr("id").substring(8),activeTabId=$(".topictab.active").first().attr("id");void 0===activeTabId&&(activeTabId="tab0"),add2tab(tabnum,sectionid,sectionnum),$("#tab"+tabnum).click(),$("#"+activeTabId).click(),restoreTab($("#tab"+tabnum));var countableSections=$("li.section:visible").length-($("#ontop_area").hasClass("section0_ontop")?1:0);countableSections>0&&$("li.section:visible").length>=countableSections?($("#tab"+tabnum).click(),$("#"+activeTabId).click()):($("#tab"+tabnum).click(),$("#"+activeTabId).parent().hide())})),$(".ontop_mover").on("click",(function(){$("ul#ontop_area").append($(this).closest(".section")).addClass("section0_ontop"),$("#section-0").removeClass("main")})),$(".inline_mover").on("click",(function(){var sectionid=$(this).closest(".section").attr("section-id");$("#inline_area").append($(this).closest(".section")),$("#section-0").addClass("main"),$(".section0_ontop").removeClass("section0_ontop"),$(".tablink").each((function(){return $(this).attr("sections").indexOf(sectionid)>-1&&($(this).click(),!1)}))})),$(".menubar").on("click",(function(){if($(this).parent().parent().hasClass("section_action_menu")){var sectionid=$(this).closest(".section").attr("id");$("#"+sectionid+" .tab_mover").show();var tabArray=[],trackIds=[];if($(".tablink").each((function(){if(void 0!==$(this).attr("id")){var tabname="",tabid=$(this).attr("id").substr(3);tabname=$(this).hasClass("tabsectionname")?$(this).html():$(this).find(".inplaceeditable").attr("data-value"),$.inArray(tabid,trackIds)<0&&($(this).hasClass("hidden-tab")&&((tabname=$(this).find("a").clone()).find("span.quickediticon").remove(),tabname=$.trim(tabname.html())),tabArray[tabid]=tabname,trackIds.push(tabid))}})),$(this).parent().find(".tab_mover").each((function(){var tabnr=$(this).attr("tabnr"),newMenuText="To Tab "+(""===tabArray[tabnr]||tabArray[tabnr]==="Tab "+tabnr?tabnr:'"'+tabArray[tabnr]+(tabArray[tabnr]==="Tab "+tabnr||"0"===tabnr?'"':'" (Tab '+tabnr+")"));$(this).find(".menu-action-text").html(newMenuText)})),"section-0"===sectionid)1===$("#ontop_area.section0_ontop").length?($("#section-0 .inline_mover").show(),$("#section-0 .tab_mover").addClass("tab_mover_bak").removeClass("tab_mover").hide(),$("#section-0 .ontop_mover").hide()):($("#section-0 .inline_mover").hide(),$("#section-0 .tab_mover_bak").addClass("tab_mover").removeClass("tab_mover_bak").show(),$("#section-0 .ontop_mover").show());else if(void 0!==$(".tablink.active").attr("id")){var tabnum=$(".tablink.active").attr("id").substring(3);$("#"+sectionid+' .tab_mover[tabnr="'+tabnum+'"]').hide()}0===$(".tablink:visible").length&&$("#"+sectionid+' .tab_mover[tabnr="0"]').hide()}})),$("#changenumsections").on("click",(function(){var numSections=$(".section.main").length;sessionStorage.setItem("numSections",numSections)})),$(document).keyup((function(e){var code=e.keyCode||e.which,focused=$(":focus");13===code&&(void 0!==focused.attr("id")&&focused.attr("id").indexOf("tab")>-1&&focused.click(),void 0!==focused.attr("id")&&focused.attr("id").indexOf("section")>-1&&focused.find(".toggler:visible").click())})),$(".section-actions .menubar .action-menu-trigger .dropdown .dropdown-menu .dropdown-item").on("click",(function(){var activeTab=$(".tablink.active"),visibleSections=$("li.section:visible").length,hiddenSections=$("li.section:visible").find(".section_availability").find(".ishidden").length;$(this).find(".menu-action-text").html().indexOf("Hide")>=0&&null!=activeTab.attr("id")&&visibleSections<=hiddenSections+$(".section0_ontop").length+1&&showTabHint(activeTab),$(this).find(".menu-action-text").html().indexOf("Show")>=0&&null!=activeTab.attr("id")&&hideTabHint(activeTab)})),$("a").click((function(){if("#"!==$(this).attr("href")&&void 0!==$(this).attr("href")){var sectionnum=$(this).attr("href").split("#")[1];if(void 0!==sectionnum){var sectionid=$("#"+sectionnum).attr("section-id"),foundIt=!1;$(".tablink").each((function(){if($(this).attr("sections").indexOf(sectionid)>-1)return $(this).click(),foundIt=!0,!1})),foundIt||$("#tab0").click()}}})),$(".section").on("updated",(function(){var newSectionname=$(this).find(".inplaceeditable").attr("data-value");$(this).attr("aria-label",newSectionname),$(".tablink.active").click()}))},handleTabDropEvent=function(event,ui){var courseFormatName=$(document).find(".course_format_name").html(),draggedTab=ui.draggable.find(".topictab").first(),targetTab=$(this).find(".topictab").first(),zwischenspeicher=draggedTab.parent().html();draggedTab.parent().html(targetTab.parent().html()),targetTab.parent().html(zwischenspeicher),initFunctions();var tabSeqA=[];$(".tablink").each((function(){var tabid=$(this).attr("id");void 0!==tabid&&(tabSeqA.includes(tabid)||tabSeqA.push(tabid))}));var tabSeq=tabSeqA.join(),courseid=$("#courseid").attr("courseid");$.ajax({url:"format/topics2/ajax/update_tab_seq.php",type:"POST",data:{courseid:courseid,tab_seq:tabSeq,course_format_name:courseFormatName,sesskey:M.cfg.sesskey},success:function(result){console.log("updated tab sequence: "+result)}})};$(document).ready((function(){initFunctions(),$("#section-0 .right.side").show(),truncateAllTabnames(),$(".inplaceeditable").length>0&&($(".topictab").parent().draggable({cursor:"move",stack:".tabitem",revert:!0}),$(".topictab").parent().droppable({accept:".tabitem",hoverClass:"hovered",drop:handleTabDropEvent}));var courseid=$("#courseid").attr("courseid"),originCourseid=sessionStorage.getItem("courseid"),tabid=null;if(null!==originCourseid&&originCourseid==courseid?tabid=sessionStorage.getItem("tabid"):(sessionStorage.removeItem("courseid"),sessionStorage.removeItem("tabid")),$("#tab0").click(),$(".tablink:visible").click(),$(".topictab:visible").length>0)if(null!==tabid&&"tab0"!=tabid){var numSections=sessionStorage.getItem("numSections");if(sessionStorage.removeItem("numSections"),null!==numSections){var tabnum=tabid.substring(3),i=0;$(".section.main").each((function(){if((i+=1)>numSections){var sectionid=$(this).attr("section-id"),sectionnum=$(this).attr("id").substring(8);add2tab(tabnum,sectionid,sectionnum)}})),function(tabid){var courseid=$("#courseid").attr("courseid");$.ajax({url:"format/topics2/ajax/update_tab_settings.php",type:"POST",data:{courseid:courseid,tabid:tabid,sections:$("#"+tabid).attr("sections"),sectionnums:$("#"+tabid).attr("section_nums"),sesskey:M.cfg.sesskey},success:function(result){}})}(tabid)}$("#"+tabid).click()}else $(".tablink:visible").first().click();$("#ontop_area").hasClass("section0_ontop")?($("#section-0 .inline_mover").show(),$("#section-0 .tab_mover").hide(),$("#section-0 .ontop_mover").hide()):($("#section-0 .inline_mover").hide(),$("#section-0 .tab_mover").show(),$("#section-0 .ontop_mover").show())}))}}}));

//# sourceMappingURL=tabs.min.js.map